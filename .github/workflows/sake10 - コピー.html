<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お酒診断アプリ</title>
    <!-- Tailwind CSSのCDNを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interフォントを適用 */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* テキスト内の改行を保持 */
        .whitespace-pre-line {
            white-space: pre-line;
        }
        /* 質問文のフェードイン/アウトを制御するスタイル */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.5s ease;
        }
        .fade-enter, .fade-leave-to {
            opacity: 0;
        }
        /* ボタンのクリック時にスケールダウンする効果 */
        .btn-active-scale:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

<div id="app" class="bg-white rounded-xl shadow-lg p-8 w-full max-w-lg text-center flex flex-col items-center">
    <!-- 質問文のコンテナ -->
    <div id="question-container" class="min-h-[120px] mb-8 flex items-center justify-center transition-opacity duration-500">
        <p id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 whitespace-pre-line"></p>
    </div>

    <!-- 選択肢ボタンのコンテナ -->
    <div id="options-container" class="space-y-4 w-full">
        <button id="option1-btn" class="option-btn bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-6 rounded-full w-full transition duration-300 transform btn-active-scale shadow-md">選択肢 1</button>
        <button id="option2-btn" class="option-btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-4 px-6 rounded-full w-full transition duration-300 transform btn-active-scale shadow-md">選択肢 2</button>
    </div>

    <!-- 結果表示と再診断ボタンのコンテナ -->
    <div id="result-container" class="hidden flex-col items-center mt-8">
        <p id="result-text" class="text-2xl font-bold text-green-700 whitespace-pre-line leading-relaxed"></p>
        <button id="restart-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-full mt-6 transition duration-300 transform btn-active-scale shadow-md">もう一度診断する</button>
    </div>
</div>

<script>
    // 診断ツリーのノードを表すクラス
    class Node {
        constructor(text, option1Text, option2Text) {
            this.text = text;
            this.option1 = null;
            this.option2 = null;
            this.option1Text = option1Text;
            this.option2Text = option2Text;
        }

        isLeaf() {
            return this.option1 === null && this.option2 === null;
        }
    }

    // DOM要素の取得
    const app = document.getElementById('app');
    const questionContainer = document.getElementById('question-container');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const option1Btn = document.getElementById('option1-btn');
    const option2Btn = document.getElementById('option2-btn');
    const resultContainer = document.getElementById('result-container');
    const resultText = document.getElementById('result-text');
    const restartBtn = document.getElementById('restart-btn');

    let currentNode;
    let selectedChoices = [];

    // 診断ツリーの構築
    function buildTree() {
        // 結果ノード
        const result1 = new Node("華やかでフルーティな香りと、まろやかな甘みが特徴の「純米大吟醸」はいかがでしょうか。特別な日の贈り物にも最適です。");
        const result2 = new Node("すっきりとした味わいの「純米吟醸」はいかがでしょうか。和食はもちろん、様々な料理と相性が良く、食事と一緒に楽しむのがおすすめです。");
        const result3 = new Node("フレッシュでフルーティな香りと、若々しい味わいが特徴の「生酒」はいかがでしょうか。");
        const result4 = new Node("キリッと引き締まった酸味と、爽やかな味わいが特徴の「生酒」はいかがでしょうか。");
        const result5 = new Node("濃厚な味わいと、コクのある「純米酒」はいかがでしょうか。");
        const result6 = new Node("お米本来の旨みと、すっきりとした味わいが特徴の「純米酒」はいかがでしょうか。");
        const result7 = new Node("フレッシュでフルーティな香りと、若々しい味わいが特徴の「生酒」はいかがでしょうか。");
        const result8 = new Node("キリッと引き締まった酸味と、爽やかな味わいが特徴の「生酒」はいかがでしょうか。");

        // 中間ノード
        const souvenirSweetOrDry = new Node("甘口と辛口、どちらがお好みですか？", "甘口", "辛口");
        souvenirSweetOrDry.option1 = result1; // 純米大吟醸
        souvenirSweetOrDry.option2 = result2; // 純米吟醸

        const souvenirUnpasteurizedSweetOrDry = new Node("甘口と辛口、どちらがお好みですか？", "甘口", "辛口");
        souvenirUnpasteurizedSweetOrDry.option1 = result3;
        souvenirUnpasteurizedSweetOrDry.option2 = result4;

        // 容量選択ノード
        const souvenirVolume = new Node("容量は720mlと1800mlどちらが良いですか？", "720ml", "1800ml");
        souvenirVolume.option1 = souvenirSweetOrDry;
        souvenirVolume.option2 = souvenirSweetOrDry;

        const souvenirVolumeUnpasteurized = new Node("容量は720mlと1800mlどちらが良いですか？", "720ml", "1800ml");
        souvenirVolumeUnpasteurized.option1 = souvenirUnpasteurizedSweetOrDry;
        souvenirVolumeUnpasteurized.option2 = souvenirUnpasteurizedSweetOrDry;

        const souvenirPasteurizedOrUnpasteurized = new Node("火入れ酒と生酒、どちらが良いですか？", "火入れ酒", "生酒");
        souvenirPasteurizedOrUnpasteurized.option1 = souvenirVolume;
        souvenirPasteurizedOrUnpasteurized.option2 = souvenirVolumeUnpasteurized;

        const personalSweetOrDry = new Node("甘口と辛口、どちらがお好みですか？", "甘口", "辛口");
        personalSweetOrDry.option1 = result5; // 純米酒
        personalSweetOrDry.option2 = result6; // 純米酒

        const personalUnpasteurizedSweetOrDry = new Node("甘口と辛口、どちらがお好みですか？", "甘口", "辛口");
        personalUnpasteurizedSweetOrDry.option1 = result7;
        personalUnpasteurizedSweetOrDry.option2 = result8;

        const personalPasteurizedOrUnpasteurized = new Node("火入れ酒と生酒、どちらが良いですか？", "火入れ酒", "生酒");
        personalPasteurizedOrUnpasteurized.option1 = personalSweetOrDry;
        personalPasteurizedOrUnpasteurized.option2 = personalUnpasteurizedSweetOrDry;

        // ルートノード
        const root = new Node("どんな目的で日本酒を選びますか？", "お土産用", "自分用");
        root.option1 = souvenirPasteurizedOrUnpasteurized;
        root.option2 = personalPasteurizedOrUnpasteurized;

        return root;
    }

    function processChoice(choice) {
        // 選択された内容を記録
        const selectedText = choice === 1 ? currentNode.option1Text : currentNode.option2Text;
        if(selectedText) {
            selectedChoices.push(selectedText);
        }

        // 質問を非表示にしてフェードアウト
        questionContainer.classList.add('opacity-0');
        optionsContainer.classList.add('opacity-0');
        optionsContainer.style.pointerEvents = 'none';

        setTimeout(() => {
            // フェードアウト完了後に次のノードへ移動
            if (choice === 1 && currentNode.option1) {
                currentNode = currentNode.option1;
            } else if (choice === 2 && currentNode.option2) {
                currentNode = currentNode.option2;
            } else {
                console.error("Invalid choice.");
                return;
            }
            displayCurrentNode();
        }, 500); // CSSアニメーションの時間と合わせる
    }

    function displayCurrentNode() {
        if (currentNode.isLeaf()) {
            // 最終結果の表示
            questionContainer.style.display = 'none';
            optionsContainer.style.display = 'none';
            resultContainer.style.display = 'flex';
            
            let summaryText = `あなたが選んだのは...${selectedChoices.join("・")}の組み合わせですね。\n\n${currentNode.text}`;
            summaryText += "\n\n他に気になることがありましたら、店員にご相談ください。";
            
            resultText.textContent = summaryText;
        } else {
            // 質問の表示
            questionContainer.style.display = 'flex';
            optionsContainer.style.display = 'flex';
            resultContainer.style.display = 'none';

            questionText.textContent = currentNode.text;

            option1Btn.textContent = currentNode.option1Text;
            option2Btn.textContent = currentNode.option2Text;

            // フェードイン
            questionContainer.classList.remove('opacity-0');
            optionsContainer.classList.remove('opacity-0');
            optionsContainer.style.pointerEvents = 'auto';
        }
    }

    function restartDiagnosis() {
        // 画面をリセット
        questionContainer.style.display = 'flex';
        optionsContainer.style.display = 'flex';
        resultContainer.style.display = 'none';
        
        // 選択履歴をリセット
        selectedChoices = [];

        // ツリーを最初から構築
        currentNode = buildTree();
        displayCurrentNode();
    }

    // イベントリスナーの設定
    option1Btn.addEventListener('click', () => processChoice(1));
    option2Btn.addEventListener('click', () => processChoice(2));
    restartBtn.addEventListener('click', restartDiagnosis);

    // アプリケーションの開始
    currentNode = buildTree();
    displayCurrentNode();
</script>

</body>
</html>
